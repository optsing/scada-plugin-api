!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.PluginApi=n():e.PluginApi=n()}(window,(function(){return function(e){var n={};function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(n){return e[n]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n),t.d(n,"isInIframe",(function(){return d})),t.d(n,"addListener",(function(){return a})),t.d(n,"getCurrentUser",(function(){return c})),t.d(n,"sendNotifi",(function(){return l})),t.d(n,"sendCommand",(function(){return f})),t.d(n,"loadTextFile",(function(){return _})),t.d(n,"saveTextFile",(function(){return v})),t.d(n,"loadJSONFile",(function(){return p})),t.d(n,"saveJSONFile",(function(){return m})),t.d(n,"loadDevicesDefinitions",(function(){return g})),t.d(n,"saveDeviceDefinition",(function(){return w})),t.d(n,"saveDeviceDescription",(function(){return b})),t.d(n,"saveDeviceTileVariables",(function(){return h})),t.d(n,"saveDeviceCommands",(function(){return y})),t.d(n,"loadDevicesData",(function(){return D})),t.d(n,"loadDeviceData",(function(){return S})),t.d(n,"updateCache",(function(){return x})),t.d(n,"saveSection",(function(){return j})),t.d(n,"addSection",(function(){return P})),t.d(n,"removeSection",(function(){return O})),t.d(n,"loadSection",(function(){return T})),t.d(n,"loadSections",(function(){return M})),t.d(n,"navigateTo",(function(){return C})),t.d(n,"addToMailing",(function(){return F})),t.d(n,"removeFromMailing",(function(){return k})),t.d(n,"identify",(function(){return N})),t.d(n,"loadSettings",(function(){return J})),t.d(n,"updateUrl",(function(){return U}));const i=window.location!==window.parent.location,r={},o=[];function d(){return i}function u(e,n,t=""){if(i){const i=new Promise((n,i)=>{const r={method:e,tag:t,resolve:n,reject:i};o.push(r)});return function(e,n,t=""){window.parent.postMessage({type:"PluginApi",method:e,tag:t,data:n},"*")}(e,n,t),i}return Promise.reject(new Error("Plugin Api: Not in iframe"))}function s(e,n,t,i){e in r?r[e](t,i,n):function(e,n,t,i){const r=o.findIndex(t=>t.method===e&&t.tag===n);r>-1&&(t?o[r].reject(t):o[r].resolve(i),o.splice(r,1))}(e,n,t,i)}function a(e,n){r[e]=n}function c(){return u("getCurrentUser")}function l(e){return u("notifi",e)}function f(e,n,t){return u("sendCommand",{dev_id:e,command:n,argument:t},e+n+t)}function _(e){return u("readFile",{filename:e},e)}function v(e,n,t=!1){return u("writeFile",{filename:e,is_overwrite:t,content:n},e)}async function p(e,n=JSON){const t=await _(e);return n.parse(t)}function m(e,n,t=!1){return v(e,JSON.stringify(n,null,4),t)}function g(){return u("getDevicesDefinitions")}function w(e,{title:n=e,section:t="unsorted",status_variable:i="",mnemo:r="",url:o="",bg_image:d="",plugins:s=[]}={}){return u("saveDeviceDefinitionAdvanced",{dev_id:e,title:n,section:t,status_variable:i,mnemo:r,url:o,bg_image:d,plugins:s},e)}function b(e,{system:n="",model:t="",location:i="",service:r="",description:o="",additional:d=""}){return u("saveDeviceDescription",{dev_id:e,system:n,model:t,location:i,service:r,description:o,additional:d},e)}function h(e,n){return u("saveDeviceTileVariables",{dev_id:e,variable_ids:n},e)}function y(e,n){return u("saveDeviceCommands",{dev_id:e,variable_ids:n},e)}function D(){return u("getDevicesData")}function S(e){return u("getDeviceData",{dev_id:e})}function x(e="",n=!1){return u("updateCache",{path:e,replace_history:n})}function j({id:e="",old_id:n="",title:t="",subtitle:i="",icon:r="",mnemo:o="",view:d="tiles_mnemo",linked_dev_id:s="",use_dev_state:a=!1,subtitle_prop:c="_service",is_uncollapsed:l=!0,is_mixed:f=!1,is_hidden_sidebar:_=!1,parents:v=["root"],children:p=[],sorting:m=[],slideshow:g=[],owners:w=[],slideshow_width:b=50}={}){return u("saveSection",{id:e,old_id:n,title:t,subtitle:i,icon:r,mnemo:o,view:d,linked_dev_id:s,use_dev_state:a,subtitle_prop:c,is_uncollapsed:l,is_mixed:f,is_hidden_sidebar:_,parents:v,children:p,sorting:m,slideshow:g,owners:w,slideshow_width:b},e)}function P({id:e="",title:n="",subtitle:t="",icon:i="",mnemo:r="",view:o="tiles_mnemo",linked_dev_id:d="",use_dev_state:s=!1,subtitle_prop:a="_service",is_uncollapsed:c=!0,is_mixed:l=!1,is_hidden_sidebar:f=!1,parents:_=["root"],children:v=[],sorting:p=[],slideshow:m=[],owners:g=[],slideshow_width:w=50}={}){return u("addSection",{id:e,title:n,subtitle:t,icon:i,mnemo:r,view:o,linked_dev_id:d,use_dev_state:s,subtitle_prop:a,is_uncollapsed:c,is_mixed:l,is_hidden_sidebar:f,parents:_,children:v,sorting:p,slideshow:m,owners:g,slideshow_width:w},e)}function O(e){return u("removeSection",{id:e},e)}function T(e){return u("getSection",{id:e},e)}function M(){return u("getSections")}function C(e,{query:n={},replace_history:t=!1}={}){return u("navigateTo",{path:e,query:n,replace_history:t},e)}function F(e,n){return u("addToMailing",{mail_id:e,device_ids:n},e.toString())}function k(e,n){return u("removeFromMailing",{mail_id:e,device_ids:n},e.toString())}let A;async function N(){if(!A){const e=await u("identify");A=e.identify_token}return A}async function J(){return u("loadSettings",{identify_token:await N()})}async function U({path:e,device_id:n}){return u("updateUrl",{path:e,device_id:n,identify_token:await N()},e)}window.addEventListener("message",e=>{"PluginApi"===e.data.type&&e.data.response&&s(e.data.method,e.data.tag,e.data.error,e.data.result)})}])}));