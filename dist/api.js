!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.PluginApi=n():e.PluginApi=n()}(self,(function(){return function(){"use strict";var e={931:function(e,n,t){t.r(n),t.d(n,{isInIframe:function(){return d},addListener:function(){return _},getCurrentUser:function(){return v},sendNotifi:function(){return p},openDevicePage:function(){return m},sendCommand:function(){return g},loadTextFile:function(){return h},saveTextFile:function(){return w},loadJSONFile:function(){return y},saveJSONFile:function(){return b},loadDevicesDefinitions:function(){return D},saveDeviceDefinition:function(){return S},saveDeviceDescription:function(){return T},saveDeviceTileVariables:function(){return x},saveDeviceCommands:function(){return k},loadDevicesData:function(){return P},loadDeviceData:function(){return C},updateCache:function(){return j},saveSection:function(){return O},addSection:function(){return F},removeSection:function(){return M},loadSection:function(){return A},loadSections:function(){return N},navigateTo:function(){return B},navigateToSection:function(){return J},navigateToDevice:function(){return L},addToMailing:function(){return U},removeFromMailing:function(){return E},loadDeviceArchiveData:function(){return q},identify:function(){return z},getPosition:function(){return I},loadSettings:function(){return V},updateUrl:function(){return W},updateTitle:function(){return G},resizeWindow:function(){return H},addButtonListener:function(){return Q},removeButtonListener:function(){return R},registerButtons:function(){return X}});const i="PluginApi",r=window.location!==window.parent.location,o={},u={};let c,a,s;function d(){return r}function l(){return Math.random().toString(36).substring(2)}function f(e,n){if(r){const t=e+l(),r=new Promise(((e,n)=>{u[t]={resolve:e,reject:n}}));return function(e,n,t=""){window.parent.postMessage({type:i,method:e,tag:t,data:n},"*")}(e,n,t),r}return Promise.reject(new Error("Plugin Api: Not in iframe"))}function _(e,n){o[e]=n}function v(){return f("getCurrentUser")}function p(e){return f("notifi",e)}function m(e,{tab:n="info"}={}){return f("openDevicePage",{device_id:e,tab:n})}function g(e,n,t){return f("sendCommand",{dev_id:e,command:n,argument:t})}function h(e){return f("readFile",{filename:e})}function w(e,n,t=!1){return f("writeFile",{filename:e,is_overwrite:t,content:n})}async function y(e,n=JSON){const t=await h(e);return n.parse(t)}function b(e,n,t=!1){return w(e,JSON.stringify(n,null,4),t)}function D(e){return f("getDevicesDefinitions",{device_ids:e})}function S(e,{title:n=e,section:t="unsorted",status_variable:i="",mnemo:r="",url:o="",bg_image:u="",plugins:c=[]}={}){return f("saveDeviceDefinitionAdvanced",{dev_id:e,title:n,section:t,status_variable:i,mnemo:r,url:o,bg_image:u,plugins:c})}function T(e,{system:n="",model:t="",location:i="",service:r="",description:o="",additional:u=""}={}){return f("saveDeviceDescription",{dev_id:e,system:n,model:t,location:i,service:r,description:o,additional:u})}function x(e,n){return f("saveDeviceTileVariables",{dev_id:e,variable_ids:n})}function k(e,n){return f("saveDeviceCommands",{dev_id:e,variable_ids:n})}function P(){return f("getDevicesData")}function C(e){return f("getDeviceData",{dev_id:e})}function j(){return f("updateCache")}function O({id:e="",old_id:n="",title:t="",subtitle:i="",icon:r="",mnemo:o="",view:u="tiles_mnemo",linked_dev_id:c="",use_dev_state:a=!1,subtitle_prop:s="_service",is_uncollapsed:d=!0,is_mixed:l=!1,is_hidden_sidebar:_=!1,parents:v=["root"],children:p=[],sorting:m=[],slideshow:g=[],owners:h=[],slideshow_width:w=50}={}){return f("saveSection",{id:e,old_id:n,title:t,subtitle:i,icon:r,mnemo:o,view:u,linked_dev_id:c,use_dev_state:a,subtitle_prop:s,is_uncollapsed:d,is_mixed:l,is_hidden_sidebar:_,parents:v,children:p,sorting:m,slideshow:g,owners:h,slideshow_width:w})}function F({id:e="",title:n="",subtitle:t="",icon:i="",mnemo:r="",view:o="tiles_mnemo",linked_dev_id:u="",use_dev_state:c=!1,subtitle_prop:a="_service",is_uncollapsed:s=!0,is_mixed:d=!1,is_hidden_sidebar:l=!1,parents:_=["root"],children:v=[],sorting:p=[],slideshow:m=[],owners:g=[],slideshow_width:h=50}={}){return f("addSection",{id:e,title:n,subtitle:t,icon:i,mnemo:r,view:o,linked_dev_id:u,use_dev_state:c,subtitle_prop:a,is_uncollapsed:s,is_mixed:d,is_hidden_sidebar:l,parents:_,children:v,sorting:p,slideshow:m,owners:g,slideshow_width:h})}function M(e){return f("removeSection",{id:e})}function A(e){return f("getSection",{id:e})}function N(){return f("getSections")}function B(e,{query:n={},replace_history:t=!1,update_cache:i=!1}={}){return f("navigateTo",{path:e,query:n,replace_history:t,update_cache:i})}function J(e,{replace_history:n=!1,update_cache:t=!1}={}){return f("navigateToSection",{id:e,replace_history:n,update_cache:t})}function L(e,{show_device_page:n=!0,replace_history:t=!1,update_cache:i=!1}={}){return f("navigateToDevice",{id:e,show_device_page:n,replace_history:t,update_cache:i})}function U(e,n){return f("addToMailing",{mail_id:e,device_ids:n})}function E(e,n){return f("removeFromMailing",{mail_id:e,device_ids:n})}function q(e,n,t,i,{step:r=60}={}){return f("getDeviceArchiveData",{device_id:e,var_list:n,date_from:t,date_to:i,step:r})}async function z(){s||(s=f("identify"));const e=await s;c=e.identify_token,a=e.position}async function I(){return a||await z(),a}async function V(){return c||await z(),f("loadSettings",{identify_token:c})}async function W({path:e,device_id:n}){return c||await z(),f("updateUrl",{path:e,device_id:n,identify_token:c})}async function G({title:e,icon:n}){return c||await z(),f("updateTitle",{title:e,icon:n,identify_token:c})}async function H(e,n,t=!1){return c||await z(),f("resizeWindow",{width:e,height:n,preserve_aspect_ratio:t,identify_token:c})}let K={};function Q(e,n){K[e]=n}function R(e){delete K[e]}async function X(e){c||await z(),K={};const n=[];return e.forEach((e=>{if("url"in e){const t={title:e.title,icon:e.icon,url:e.url};e.url_mode&&(t.url_mode=e.url_mode),n.push(t)}else if("onClick"in e){const t=l();Q(t,e.onClick);const i={title:e.title,icon:e.icon,id:t};n.push(i)}else e.separator&&n.push({separator:!0})})),f("registerButtons",{buttons:n,identify_token:c})}_("buttonClicked",((e,{id:n})=>{n in K&&K[n]()})),window.addEventListener("message",(e=>{var n,t,r,c;e.data.type===i&&e.data.response&&(n=e.data.method,t=e.data.tag,r=e.data.error,c=e.data.result,n in o?o[n](r,c,t):function(e,n,t){e in u&&(n?u[e].reject(n):u[e].resolve(t),delete u[e])}(t,r,c))}))}},n={};function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{}};return e[i](r,r.exports,t),r.exports}return t.d=function(e,n){for(var i in n)t.o(n,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:n[i]})},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t(931)}()}));