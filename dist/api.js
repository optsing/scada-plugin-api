!function(e,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.PluginApi=i():e.PluginApi=i()}(globalThis,(()=>(()=>{"use strict";var e={d:(i,t)=>{for(var n in t)e.o(t,n)&&!e.o(i,n)&&Object.defineProperty(i,n,{enumerable:!0,get:t[n]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},i={};e.r(i),e.d(i,{addButtonListener:()=>Q,addListener:()=>_,addSection:()=>O,addToMailing:()=>L,getCurrentUser:()=>v,getPosition:()=>z,getToken:()=>I,identify:()=>q,isInIframe:()=>c,loadDeviceArchiveData:()=>E,loadDeviceData:()=>C,loadDevicesData:()=>P,loadDevicesDefinitions:()=>b,loadJSONFile:()=>w,loadSection:()=>M,loadSections:()=>A,loadSettings:()=>V,loadTextFile:()=>g,navigateTo:()=>N,navigateToDevice:()=>J,navigateToSection:()=>B,openDevicePage:()=>p,registerButtons:()=>X,removeButtonListener:()=>R,removeFromMailing:()=>U,removeSection:()=>F,resizeWindow:()=>H,saveDeviceCommands:()=>k,saveDeviceDefinition:()=>D,saveDeviceDescription:()=>S,saveDeviceTileVariables:()=>T,saveJSONFile:()=>y,saveSection:()=>x,saveTextFile:()=>h,sendCommand:()=>m,sendNotifi:()=>f,updateCache:()=>j,updateTitle:()=>G,updateUrl:()=>W});const t="PluginApi",n=window.location!==window.parent.location,o={},r={};let a,d,s;function c(){return n}function u(){return Math.random().toString(36).substring(2)}function l(e,i=undefined){if(n){const n=e+u(),o=new Promise(((e,i)=>{r[n]={resolve:e,reject:i}}));return function(e,i=undefined,n=""){window.parent.postMessage({type:t,method:e,tag:n,data:i},"*")}(e,i,n),o}return Promise.reject(new Error("Plugin Api: Not in iframe"))}function _(e,i){o[e]=i}function v(){return l("getCurrentUser")}function f(e){return l("notifi",e)}function p(e,{tab:i="info"}={}){return l("openDevicePage",{device_id:e,tab:i})}function m(e,i,t){return l("sendCommand",{dev_id:e,command:i,argument:t})}function g(e){return l("readFile",{filename:e})}function h(e,i,t=!1){return l("writeFile",{filename:e,is_overwrite:t,content:i})}async function w(e,i=JSON){const t=await g(e);return i.parse(t)}function y(e,i,t=!1){return h(e,JSON.stringify(i,null,4),t)}function b(e){return l("getDevicesDefinitions",{device_ids:e})}function D(e,{title:i=e,section:t="unsorted",status_variable:n="",mnemo:o="",url:r="",bg_image:a="",plugins:d=[]}={}){return l("saveDeviceDefinitionAdvanced",{dev_id:e,title:i,section:t,status_variable:n,mnemo:o,url:r,bg_image:a,plugins:d})}function S(e,{system:i="",model:t="",location:n="",service:o="",description:r="",additional:a=""}={}){return l("saveDeviceDescription",{dev_id:e,system:i,model:t,location:n,service:o,description:r,additional:a})}function T(e,i){return l("saveDeviceTileVariables",{dev_id:e,variable_ids:i})}function k(e,i){return l("saveDeviceCommands",{dev_id:e,variable_ids:i})}function P(){return l("getDevicesData")}function C(e){return l("getDeviceData",{dev_id:e})}function j(){return l("updateCache")}function x({id:e="",old_id:i="",title:t="",subtitle:n="",icon:o="",mnemo:r="",view:a="tiles_mnemo",linked_dev_id:d="",use_dev_state:s=!1,subtitle_prop:c="_service",is_uncollapsed:u=!0,is_mixed:_=!1,is_hidden_sidebar:v=!1,parents:f=["root"],children:p=[],sorting:m=[],slideshow:g=[],owners:h=[],slideshow_width:w=50}={}){return l("saveSection",{id:e,old_id:i,title:t,subtitle:n,icon:o,mnemo:r,view:a,linked_dev_id:d,use_dev_state:s,subtitle_prop:c,is_uncollapsed:u,is_mixed:_,is_hidden_sidebar:v,parents:f,children:p,sorting:m,slideshow:g,owners:h,slideshow_width:w})}function O({id:e="",title:i="",subtitle:t="",icon:n="",mnemo:o="",view:r="tiles_mnemo",linked_dev_id:a="",use_dev_state:d=!1,subtitle_prop:s="_service",is_uncollapsed:c=!0,is_mixed:u=!1,is_hidden_sidebar:_=!1,parents:v=["root"],children:f=[],sorting:p=[],slideshow:m=[],owners:g=[],slideshow_width:h=50}={}){return l("addSection",{id:e,title:i,subtitle:t,icon:n,mnemo:o,view:r,linked_dev_id:a,use_dev_state:d,subtitle_prop:s,is_uncollapsed:c,is_mixed:u,is_hidden_sidebar:_,parents:v,children:f,sorting:p,slideshow:m,owners:g,slideshow_width:h})}function F(e){return l("removeSection",{id:e})}function M(e){return l("getSection",{id:e})}function A(){return l("getSections")}function N(e,{query:i={},replace_history:t=!1,update_cache:n=!1}={}){return l("navigateTo",{path:e,query:i,replace_history:t,update_cache:n})}function B(e,{replace_history:i=!1,update_cache:t=!1}={}){return l("navigateToSection",{id:e,replace_history:i,update_cache:t})}function J(e,{show_device_page:i=!0,replace_history:t=!1,update_cache:n=!1}={}){return l("navigateToDevice",{id:e,show_device_page:i,replace_history:t,update_cache:n})}function L(e,i){return l("addToMailing",{mail_id:e,device_ids:i})}function U(e,i){return l("removeFromMailing",{mail_id:e,device_ids:i})}function E(e,i,t,n,{step:o=60}={}){return l("getDeviceArchiveData",{device_id:e,var_list:i,date_from:t,date_to:n,step:o})}async function q(){s||(s=l("identify"));const e=await s;a=e.identify_token,d=e.position}async function z(){return d||await q(),d}async function I(){return a||await q(),l("getToken",{identify_token:a})}async function V(){return a||await q(),l("loadSettings",{identify_token:a})}async function W({path:e,device_id:i}){return a||await q(),l("updateUrl",{path:e,device_id:i,identify_token:a})}async function G({title:e,icon:i}){return a||await q(),l("updateTitle",{title:e,icon:i,identify_token:a})}async function H(e,i,t=!1){return a||await q(),l("resizeWindow",{width:e,height:i,preserve_aspect_ratio:t,identify_token:a})}let K={};function Q(e,i){K[e]=i}function R(e){delete K[e]}async function X(e){a||await q(),K={};const i=[];return e.forEach((e=>{if("url"in e){const t={title:e.title,icon:e.icon,url:e.url};e.url_mode&&(t.url_mode=e.url_mode),i.push(t)}else if("onClick"in e){const t=u();Q(t,e.onClick);const n={title:e.title,icon:e.icon,id:t};i.push(n)}else e.separator&&i.push({separator:!0})})),l("registerButtons",{buttons:i,identify_token:a})}return _("buttonClicked",((e,{id:i})=>{i in K&&K[i]()})),window.addEventListener("message",(e=>{var i,n,a,d;e.data.type===t&&e.data.response&&(i=e.data.method,n=e.data.tag,a=e.data.error,d=e.data.result,i in o?o[i](a,d,n):function(e,i,t){e in r&&(i?r[e].reject(i):r[e].resolve(t),delete r[e])}(n,a,d))})),i})()));