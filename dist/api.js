!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.PluginApi=n():e.PluginApi=n()}(window,(function(){return function(e){var n={};function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(i,r,function(n){return e[n]}.bind(null,r));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n),t.d(n,"isInIframe",(function(){return c})),t.d(n,"addListener",(function(){return _})),t.d(n,"getCurrentUser",(function(){return p})),t.d(n,"sendNotifi",(function(){return v})),t.d(n,"sendCommand",(function(){return m})),t.d(n,"loadTextFile",(function(){return g})),t.d(n,"saveTextFile",(function(){return w})),t.d(n,"loadJSONFile",(function(){return y})),t.d(n,"saveJSONFile",(function(){return h})),t.d(n,"loadDevicesDefinitions",(function(){return b})),t.d(n,"saveDeviceDefinition",(function(){return D})),t.d(n,"saveDeviceDescription",(function(){return S})),t.d(n,"saveDeviceTileVariables",(function(){return x})),t.d(n,"saveDeviceCommands",(function(){return j})),t.d(n,"loadDevicesData",(function(){return k})),t.d(n,"loadDeviceData",(function(){return P})),t.d(n,"updateCache",(function(){return T})),t.d(n,"saveSection",(function(){return C})),t.d(n,"addSection",(function(){return O})),t.d(n,"removeSection",(function(){return M})),t.d(n,"loadSection",(function(){return F})),t.d(n,"loadSections",(function(){return A})),t.d(n,"navigateTo",(function(){return N})),t.d(n,"addToMailing",(function(){return B})),t.d(n,"removeFromMailing",(function(){return J})),t.d(n,"identify",(function(){return L})),t.d(n,"getPosition",(function(){return U})),t.d(n,"loadSettings",(function(){return E})),t.d(n,"updateUrl",(function(){return q})),t.d(n,"updateTitle",(function(){return z})),t.d(n,"resizeWindow",(function(){return I})),t.d(n,"addButtonListener",(function(){return W})),t.d(n,"removeButtonListener",(function(){return G})),t.d(n,"registerButtons",(function(){return H}));const i=window.location!==window.parent.location,r={},o={};let u,d,s;function c(){return i}function a(){return Math.random().toString(36).substring(2)}function l(e,n){if(i){const t=e+a(),i=new Promise((e,n)=>{o[t]={resolve:e,reject:n}});return function(e,n,t=""){window.parent.postMessage({type:"PluginApi",method:e,tag:t,data:n},"*")}(e,n,t),i}return Promise.reject(new Error("Plugin Api: Not in iframe"))}function f(e,n,t,i){e in r?r[e](t,i,n):function(e,n,t){e in o&&(n?o[e].reject(n):o[e].resolve(t),delete o[e])}(n,t,i)}function _(e,n){r[e]=n}function p(){return l("getCurrentUser")}function v(e){return l("notifi",e)}function m(e,n,t){return l("sendCommand",{dev_id:e,command:n,argument:t})}function g(e){return l("readFile",{filename:e})}function w(e,n,t=!1){return l("writeFile",{filename:e,is_overwrite:t,content:n})}async function y(e,n=JSON){const t=await g(e);return n.parse(t)}function h(e,n,t=!1){return w(e,JSON.stringify(n,null,4),t)}function b(){return l("getDevicesDefinitions")}function D(e,{title:n=e,section:t="unsorted",status_variable:i="",mnemo:r="",url:o="",bg_image:u="",plugins:d=[]}={}){return l("saveDeviceDefinitionAdvanced",{dev_id:e,title:n,section:t,status_variable:i,mnemo:r,url:o,bg_image:u,plugins:d})}function S(e,{system:n="",model:t="",location:i="",service:r="",description:o="",additional:u=""}){return l("saveDeviceDescription",{dev_id:e,system:n,model:t,location:i,service:r,description:o,additional:u})}function x(e,n){return l("saveDeviceTileVariables",{dev_id:e,variable_ids:n})}function j(e,n){return l("saveDeviceCommands",{dev_id:e,variable_ids:n})}function k(){return l("getDevicesData")}function P(e){return l("getDeviceData",{dev_id:e})}function T(e="",n=!1){return l("updateCache",{path:e,replace_history:n})}function C({id:e="",old_id:n="",title:t="",subtitle:i="",icon:r="",mnemo:o="",view:u="tiles_mnemo",linked_dev_id:d="",use_dev_state:s=!1,subtitle_prop:c="_service",is_uncollapsed:a=!0,is_mixed:f=!1,is_hidden_sidebar:_=!1,parents:p=["root"],children:v=[],sorting:m=[],slideshow:g=[],owners:w=[],slideshow_width:y=50}={}){return l("saveSection",{id:e,old_id:n,title:t,subtitle:i,icon:r,mnemo:o,view:u,linked_dev_id:d,use_dev_state:s,subtitle_prop:c,is_uncollapsed:a,is_mixed:f,is_hidden_sidebar:_,parents:p,children:v,sorting:m,slideshow:g,owners:w,slideshow_width:y})}function O({id:e="",title:n="",subtitle:t="",icon:i="",mnemo:r="",view:o="tiles_mnemo",linked_dev_id:u="",use_dev_state:d=!1,subtitle_prop:s="_service",is_uncollapsed:c=!0,is_mixed:a=!1,is_hidden_sidebar:f=!1,parents:_=["root"],children:p=[],sorting:v=[],slideshow:m=[],owners:g=[],slideshow_width:w=50}={}){return l("addSection",{id:e,title:n,subtitle:t,icon:i,mnemo:r,view:o,linked_dev_id:u,use_dev_state:d,subtitle_prop:s,is_uncollapsed:c,is_mixed:a,is_hidden_sidebar:f,parents:_,children:p,sorting:v,slideshow:m,owners:g,slideshow_width:w})}function M(e){return l("removeSection",{id:e})}function F(e){return l("getSection",{id:e})}function A(){return l("getSections")}function N(e,{query:n={},replace_history:t=!1}={}){return l("navigateTo",{path:e,query:n,replace_history:t})}function B(e,n){return l("addToMailing",{mail_id:e,device_ids:n})}function J(e,n){return l("removeFromMailing",{mail_id:e,device_ids:n})}async function L(){s||(s=l("identify"));const e=await s;u=e.identify_token,d=e.position}async function U(){return d||await L(),d}async function E(){return u||await L(),l("loadSettings",{identify_token:u})}async function q({path:e,device_id:n}){return u||await L(),l("updateUrl",{path:e,device_id:n,identify_token:u})}async function z({title:e,icon:n}){return u||await L(),l("updateTitle",{title:e,icon:n,identify_token:u})}async function I(e,n){return u||await L(),l("resizeWindow",{width:e,height:n,identify_token:u})}let V={};function W(e,n){V[e]=n}function G(e){delete V[e]}async function H(e){u||await L(),V={};const n=[];return e.forEach(e=>{if("url"in e){const t={title:e.title,icon:e.icon,url:e.url};e.url_mode&&(t.url_mode=e.url_mode),n.push(t)}else if("onClick"in e){const t=a();W(t,e.onClick);const i={title:e.title,icon:e.icon,id:t};n.push(i)}else e.separator&&n.push({separator:!0})}),l("registerButtons",{buttons:n,identify_token:u})}_("buttonClicked",(e,{id:n})=>{n in V&&V[n]()}),window.addEventListener("message",e=>{"PluginApi"===e.data.type&&e.data.response&&f(e.data.method,e.data.tag,e.data.error,e.data.result)})}])}));